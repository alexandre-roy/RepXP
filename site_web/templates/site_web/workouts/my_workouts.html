{% extends "site_web/base.html" %}
{% block title %}
    <title>RepXP | Mes entraînements</title>
{% endblock %} {% block navigation %}

<a href="{% url 'my_workouts' %}" class="active-link">MES ENTRAÎNEMENTS</a>
<a href="{% url 'new_workout' %}" class="inactive-link">CRÉATION D'ENTRAÎNEMENTS</a>

{% endblock %} {% block main %}

<form method="get" class="my-3 pb-2 text-center d-flex justify-content-center">
    <input type="text" name="recherche" class="form-control w-25 me-3" placeholder="Rechercher un entrainement...">
    <button class="style-button" type="submit">RECHERCHER</button>
</form>

{% if entrainements %}
    <div class="accordion row justify-content-center" id="workoutsAccordion">
    {% for entrainement in entrainements %}
        <div class="col-8 accordion-item p-0">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forloop.counter }}">
                    <img src="../../../static/images/dumbbells.png" alt="default" class="exercice-image me-2">
                    <strong class="text-blue">{{ entrainement.nom }}</strong>
                </button>
            </h2>
            <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse" data-bs-parent="#workoutsAccordion">
                <div class="accordion-body pe-2">
                    {% for exo_ent in entrainement.exerciceentrainement_set.all %}
                        {% if forloop.last %}
                            <div class="d-flex justify-content-between align-items-center">
                                <p class="mb-0"><a class="text-decoration-none" href="{% url 'bank' %}?recherche={{ exo_ent.exercice.nom }}">{{ exo_ent.exercice.nom }}</a> - {{ exo_ent.sets }} x {{ exo_ent.reps }}</p>
                                <div>
                                    <a href="#" data-bs-toggle="modal" data-bs-target="#completeModal{{ entrainement.id }}"><img src="../../../static/images/check.svg" alt="default" class="me-2 edit-img"></a>
                                    <a href="{% url 'edit_workout' entrainement.id %}"><img src="../../../static/images/edit.svg" alt="default" class="me-2 edit-img"></a>
                                    <a href="#" data-bs-toggle="modal" data-bs-target="#deleteModal{{ entrainement.id }}"><img src="../../../static/images/delete.svg" alt="default" class="edit-img"></a>
                                </div>
                            </div>
                        {% else %}
                            <div class="mb-2">
                                <p class="mb-0"><a class="text-decoration-none" href="{% url 'bank' %}?recherche={{ exo_ent.exercice.nom }}">{{ exo_ent.exercice.nom }}</a> - {{ exo_ent.sets }} x {{ exo_ent.reps }}</p>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="modal fade" id="completeModal{{ entrainement.id }}" tabindex="-1" aria-labelledby="completeModalLabel{{ entrainement.id }}" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content text-center logout-popover">
                    <div class="modal-header border-0">
                        <h3 class="modal-title w-100 fw-bold" id="completeModalLabel{{ entrainement.id }}">Compléter l'entraînement</h3>
                    </div>
                    <div class="modal-body">
                        <div class="mb-4">
                            <h4 class="text-center">Avez-vous complété</h4>
                            <h4 class="text-center">l'entraînement "{{ entrainement.nom }}"?</h4>
                        </div>
                        <div class="d-flex justify-content-center">
                            <button type="button" class="style-button-danger" data-bs-dismiss="modal">ANNULER</button>
                            <form method="post" action="{% url 'complete_workout' entrainement.id %}">
                                {% csrf_token %}
                                <button type="submit" class="style-button">COMPLÉTER</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="deleteModal{{ entrainement.id }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ entrainement.id }}" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content text-center logout-popover">
                    <div class="modal-header border-0">
                        <h3 class="modal-title w-100 fw-bold" id="deleteModalLabel{{ entrainement.id }}">Confirmer la suppression</h3>
                    </div>
                    <div class="modal-body">
                        <div class="mb-4">
                            <h4 class="text-center">Voulez-vous vraiment supprimer</h4>
                            <h4 class="text-center">l'entraînement "{{ entrainement.nom }}"?</h4>
                        </div>
                        <div class="d-flex justify-content-center">
                            <button type="button" class="style-button-danger" data-bs-dismiss="modal">ANNULER</button>
                            <form method="post" action="{% url 'delete_workout' entrainement.id %}">
                                {% csrf_token %}
                                <button type="submit" class="style-button">SUPPRIMER</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
    </div>
{% else %}
    <p class="text-center">Aucun entrainement enregistré pour l'instant.</p>
{% endif %}

{% endblock %}