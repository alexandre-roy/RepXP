{% extends "site_web/base.html" %}
{% load static %}

{% block title %}
    <title>RepXP | Liste des badges</title>
{% endblock %}

{% block navigation %}
    <a href="{% url 'badge_list' %}" class="active-link">LISTE DES BADGES</a>

    {% if request.user.is_superuser or request.user.is_staff %}
        <a href="{% url 'create_badge' %}" class="inactive-link">CRÉER UN BADGE</a>
    {% endif %}
{% endblock %}

{% block main %}

<div class="container mt-5">
    <h2 class="text-center mb-4">LISTE DES BADGES</h2>

    {% regroup badges by categorie as badges_par_categorie %}

    {% if badges_par_categorie %}
        {% for groupe in badges_par_categorie %}
            <h4 class="badge-category-title mt-4">{{ groupe.grouper }}</h4>

            <div class="badges-grid">
                {% for b in groupe.list %}
                    <div class="badge-card" id="badge-{{ b.id }}">

                        {% if b.icone %}
                            <img src="{{ b.icone.url }}" class="badge-img" alt="{{ b.nom }}">
                        {% else %}
                            <img src="{% static 'images/default_badge.png' %}" class="badge-img" alt="Badge">
                        {% endif %}

                        <div class="badge-name">{{ b.nom }}</div>

                        {% if b.description|length > 80 %}

                            <div class="collapse mt-2" id="desc-{{ b.id }}">
                                <p class="badge-description-full">
                                    {{ b.description }}
                                </p>
                            </div>

                            <button class="style-button p-1 fs-6 mt-3" type="button" data-bs-toggle="collapse" data-bs-target="#desc-{{ b.id }}">
                                Voir plus
                            </button>

                        {% else %}
                            <p class="badge-description-full">
                                {{ b.description }}
                            </p>
                        {% endif %}

                        <div class="badge-condition mt-3">
                            <strong>Objectif :</strong> {{ b.seuil }} {{ b.stat_cible }}
                        </div>

                    </div>
                {% endfor %}
            </div>

        {% endfor %}
    {% else %}
        <p class="text-center text-muted mt-5">Aucun badge n’a encore été créé.</p>
    {% endif %}
</div>

{% endblock %}
